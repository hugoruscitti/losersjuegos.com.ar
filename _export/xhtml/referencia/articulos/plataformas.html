<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="es"
 lang="es" dir="ltr">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>referencia:articulos:plataformas</title>
<meta name="generator" content="DokuWiki Release 2009-02-14b" />
<meta name="robots" content="index,follow" />
<meta name="date" content="2009-01-20T17:24:42+0300" />
<meta name="keywords" content="referencia,articulos,plataformas" />
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="Losersjuegos" />
<link rel="start" href="../../../../index.html" />
<link rel="contents" href="../../../../referencia/articulos/plataformas-do=index.html" title="Indice" />
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php.rss" />
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php-mode=list&amp;ns=referencia-articulos.rss" />
<link rel="alternate" type="text/html" title="Plain HTML" href="plataformas.html" />
<link rel="alternate" type="text/plain" title="Wiki Markup" href="../../../raw/referencia/articulos/plataformas.txt" />
<link rel="stylesheet" media="all" type="text/css" href="../../../../lib/exe/css.php-s=all&amp;t=sidebar.css" />
<link rel="stylesheet" media="screen" type="text/css" href="../../../../lib/exe/css.php-t=sidebar.css" />
<link rel="stylesheet" media="print" type="text/css" href="../../../../lib/exe/css.php-s=print&amp;t=sidebar.css" />
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php-edit=0&amp;write=0.js" ></script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div class="toc">
<div class="tocheader toctoggle" id="toc__header">Tabla de Contenidos</div>
<div id="toc__inside">

<ul class="toc">
<li class="level1"><div class="li"><span class="li"><a href="#colision_de_plataformas" class="toc">Colisión de plataformas</a></span></div>
<ul class="toc">
<li class="level2"><div class="li"><span class="li"><a href="#creditos" class="toc">Créditos</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="#introduccion" class="toc">Introducción</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="#tiles_y_matriz" class="toc">Tiles y matriz</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="#almacenar_la_matriz_en_memoria" class="toc">Almacenar la Matriz en memoria</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="#cargar_el_mapa" class="toc">Cargar el mapa</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="#imprimir_el_mapa" class="toc">Imprimir el mapa</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="#colisiones" class="toc">Colisiones</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="#ejemplo" class="toc">Ejemplo</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="#creditos1" class="toc">Créditos</a></span></div></li></ul>
</li></ul>
</div>
</div>
<!-- TOC END -->

<p>
<a href="../../../../_media/referencia/articulos/plataformas/plataformas.pdf" class="media mediafile mf_pdf" title="referencia:articulos:plataformas:plataformas.pdf">Ver PDF</a>

</p>

<h1><a name="colision_de_plataformas" id="colision_de_plataformas">Colisión de plataformas</a></h1>
<div class="level1">

</div>
<!-- SECTION "Colisión de plataformas" [62-98] -->
<h2><a name="creditos" id="creditos">Créditos</a></h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <strong>Autor:</strong> Hugo Ruscitti</div>
</li>
<li class="level2"><div class="li"> <strong>Fecha:</strong> Domingo 17 de Abril del 2005</div>
</li>
</ul>

</div>
<!-- SECTION "Créditos" [99-197] -->
<h2><a name="introduccion" id="introduccion">Introducción</a></h2>
<div class="level2">

<p>

<a href="../../../../_detail/referencia/articulos/plataformas/figura1.png-id=referencia-articulos-plataformas.html" class="media" title="referencia:articulos:plataformas:figura1.png"><img src="../../../../_media/referencia/articulos/plataformas/figura1.png" class="mediacenter" alt="" /></a>
</p>

<p>
Los videojuegos de plataformas fueron muy populares en los primeros años de las consolas portátiles; <em>Mario Bros, Donkey Kong</em> y <em>Sonic</em> son muy buenos ejemplos de esta clase de juegos.
</p>

<p>
En este artículo veremos como implementar los escenarios de un juego de plataformas mediante pequeños bloques (tiles) y como programar las colisiones con estos bloques.

</p>

</div>
<!-- SECTION "Introducción" [198-638] -->
<h2><a name="tiles_y_matriz" id="tiles_y_matriz">Tiles y matriz</a></h2>
<div class="level2">

<p>

Si necesitamos crear un mapa como el de la <em>figura 1</em>, podemos utilizar una técnica que consiste en representar todo el mapa mediante una matriz con números y un conjunto de gráficos muy pequeños llamados tiles.
</p>

<p>
<a href="../../../../_detail/referencia/articulos/plataformas/figura2.png-id=referencia-articulos-plataformas.html" class="media" title="referencia:articulos:plataformas:figura2.png"><img src="../../../../_media/referencia/articulos/plataformas/figura2.png" class="mediacenter" alt="" /></a>
</p>

<p>
La <em>figura 2</em> muestra cómo combinar la matriz con los tiles para obtener el mapa completo. Cada gráfico tiene asignado un número y está cargado en memoria una sola vez. Los elementos (o celdas) de la matriz indican que gráficos se deben imprimir; la posición de estos elementos nos permiten determinar la posición final de cada tile en pantalla.

</p>

</div>
<!-- SECTION "Tiles y matriz" [639-1290] -->
<h2><a name="almacenar_la_matriz_en_memoria" id="almacenar_la_matriz_en_memoria">Almacenar la Matriz en memoria</a></h2>
<div class="level2">

<p>

El tamaño de la matriz depende del área total del mapa y del tamaño de los tiles. En nuestro caso el área del mapa es igual al de la pantalla, <em>320&times;240</em> pixels sin desplazamiento (scroll). Mientras que el tamaño de cada tile es de <em>16&times;16</em> pixels.
</p>

<p>
La relación es muy sencilla y debemos recordarla mas adelante:

</p>
<pre class="code c++"><span class="kw4">int</span> columnas_de_la_matriz;
<span class="kw4">int</span> filas_de_la_matriz;
&nbsp;
columnas_de_la_matriz <span class="sy0">=</span> ancho_del_mapa <span class="sy0">/</span> ancho_del_tile
filas_de_la_matriz <span class="sy0">=</span> alto_del_mapa <span class="sy0">/</span> alto_del_tile</pre>
<p>
Para nuestro ejemplo:

</p>
<pre class="code c++">columnas <span class="sy0">=</span> <span class="nu0">640</span> <span class="sy0">/</span> <span class="nu0">16</span>
filas <span class="sy0">=</span> <span class="nu0">480</span> <span class="sy0">/</span> <span class="nu0">32</span></pre>
<p>
La matriz debe tener 20 columnas y 15 filas.

</p>

</div>
<!-- SECTION "Almacenar la Matriz en memoria" [1291-1956] -->
<h2><a name="cargar_el_mapa" id="cargar_el_mapa">Cargar el mapa</a></h2>
<div class="level2">

<p>

Como un juego de plataformas suele tener muchos niveles es adecuado almacenar estos niveles en un archivo (o varios) separados del código principal, ya que así podremos modificar los niveles con mayor facilidad.
</p>

<p>
Incluso podemos desarrollar un editor de niveles para manejar estos archivos.
</p>

<p>
Así, cargar el mapa consiste en leer el archivo de niveles y almacenar su contenido en las celdas de la matriz.
</p>

<p>
En este ejemplo el mapa de nivel está en un simple archivo de textos para facilitar su edición.

</p>

</div>
<!-- SECTION "Cargar el mapa" [1957-2488] -->
<h2><a name="imprimir_el_mapa" id="imprimir_el_mapa">Imprimir el mapa</a></h2>
<div class="level2">

<p>

En la <em>figura 3</em> podemos ver el proceso de impresión. Simplemente se debe leer el contenido de la matriz imprimiendo el gráfico indicado en la pantalla.
</p>

<p>
<a href="../../../../_detail/referencia/articulos/plataformas/figura3.png-id=referencia-articulos-plataformas.html" class="media" title="referencia:articulos:plataformas:figura3.png"><img src="../../../../_media/referencia/articulos/plataformas/figura3.png" class="mediacenter" alt="" /></a>
</p>

<p>
La posición final de cada bloque sobre la pantalla se obtiene desde la matriz a medida que leemos la cada una de las celdas:

</p>
<pre class="code c++">x_destino <span class="sy0">=</span> columna_actual <span class="sy0">*</span> ancho_del_tile
y_destino <span class="sy0">=</span> fila_actual <span class="sy0">*</span> alto_del_tile</pre>
</div>
<!-- SECTION "Imprimir el mapa" [2489-2955] -->
<h2><a name="colisiones" id="colisiones">Colisiones</a></h2>
<div class="level2">

<p>

En el ejemplo, nuestro personaje puede &#039;pararse&#039; sobre cada una de las plataformas del juego y además &#039;colisionar&#039; con las paredes del nivel.
</p>

<p>
Una forma muy simple de aplicar estas colisiones con las plataformas es determinar, siempre que sea necesario, cual es la distancia entre el personaje y la próxima plataforma o pared.
</p>

<p>
<a href="../../../../_detail/referencia/articulos/plataformas/figura4.png-id=referencia-articulos-plataformas.html" class="media" title="referencia:articulos:plataformas:figura4.png"><img src="../../../../_media/referencia/articulos/plataformas/figura4.png" class="mediacenter" alt="" /></a>
</p>

<p>
La <em>figura 4</em> muestra estas distancias. Si nuestro personaje está caminando hacia una pared es necesario detenerlo antes de que pueda cruzarla. Lo mismo ocurre cuando un personaje cae en su salto, debemos detenerlo en el suelo e indicarle que su caída terminó.
</p>

<p>
Todo avance del personaje puede superar el pixel, es decir, en un instante dado nuestro personaje podría necesitar avanzar unos 20 pixels a la vez. Si en ese trayecto encontramos una plataforma debemos detener el movimiento y avanzar menos de lo que queríamos recorrer.
</p>

<p>
Para implementar ese control podemos realizar una función que determine, dada una coordenada y rango, la distancia hasta el próxima plataforma:

</p>
<pre class="code c++"><span class="kw4">int</span> nivel <span class="sy0">::</span> <span class="me2">get_dist_suelo</span> <span class="br0">&#40;</span><span class="kw4">int</span> x<span class="sy0">,</span> <span class="kw4">int</span> y<span class="sy0">,</span> <span class="kw4">int</span> rango<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
        <span class="kw4">int</span> cont;
&nbsp;
        <span class="kw1">for</span> <span class="br0">&#40;</span>cont <span class="sy0">=</span> <span class="nu19">0</span>; cont <span class="sy0">&lt;</span> rango; cont <span class="sy0">++</span><span class="br0">&#41;</span>
&nbsp;
&nbsp;
        <span class="br0">&#123;</span>
                <span class="kw1">if</span> <span class="br0">&#40;</span>es_suelo<span class="br0">&#40;</span>x<span class="sy0">,</span> y <span class="sy0">+</span> cont<span class="br0">&#41;</span><span class="br0">&#41;</span>
&nbsp;
                        <span class="kw1">return</span> cont;
        <span class="br0">&#125;</span>
&nbsp;
        <span class="kw1">return</span> rango; <span class="co1">// no encuentra un suelo</span>
<span class="br0">&#125;</span></pre>
<p>
El objetivo de la función <em>get_dist_suelo</em> es buscar, punto a punto, la existencia de un suelo sin exceder el rango (tercer parámetro). Si encuentra un suelo nos retorna la distancia al mismo, en caso contrario nos retorna el valor de rango.
</p>

<p>
La función <em>es_suelo</em> simplemente verifica si un bloque es sólido o no. Sus parámetros corresponden a una coordenada de la pantalla (320&times;240):

</p>
<pre class="code c++">bool nivel <span class="sy0">::</span> <span class="me2">es_suelo</span> <span class="br0">&#40;</span><span class="kw4">int</span> x<span class="sy0">,</span> <span class="kw4">int</span> y<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
        <span class="co1">// el suelo sólo es colisionable en su parte</span>
        <span class="co1">// superior, mediante el resto de la división (%)</span>
        <span class="co1">// verificamos este caso</span>
&nbsp;
&nbsp;
        <span class="kw1">if</span> <span class="br0">&#40;</span>y <span class="sy0">%</span> <span class="nu0">16</span> <span class="sy0">==</span> <span class="nu19">0</span> <span class="sy0">&amp;&amp;</span> es_solido<span class="br0">&#40;</span>x<span class="sy0">,</span> y<span class="br0">&#41;</span><span class="br0">&#41;</span>
                <span class="kw1">return</span> <span class="kw2">true</span>;
        <span class="kw1">else</span>
                <span class="kw1">return</span> <span class="kw2">false</span>;
<span class="br0">&#125;</span>
&nbsp;
bool nivel <span class="sy0">::</span> <span class="me2">es_solido</span> <span class="br0">&#40;</span><span class="kw4">int</span> x<span class="sy0">,</span> <span class="kw4">int</span> y<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
        <span class="kw1">return</span> tiles<span class="br0">&#91;</span>y <span class="sy0">/</span> <span class="nu0">16</span><span class="br0">&#93;</span><span class="br0">&#91;</span>x <span class="sy0">/</span> <span class="nu0">16</span><span class="br0">&#93;</span>.<span class="me1">solido</span>;
<span class="br0">&#125;</span></pre>
<p>
Para utilizar estas funciones simplemente debemos tener una referencia al nivel:

</p>
<pre class="code c++"><span class="br0">&#91;</span>...<span class="br0">&#93;</span>
&nbsp;
dist <span class="sy0">+=</span> nivel<span class="sy0">-&gt;</span>get_dist_suelo<span class="br0">&#40;</span>x<span class="sy0">,</span> y<span class="sy0">,</span> <span class="nu0">20</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">&#40;</span>dist <span class="sy0">==</span> <span class="nu0">20</span><span class="br0">&#41;</span>
        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;No existe un suelo a menos de 20 pixels<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span>;
<span class="kw1">else</span>
        <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Hay una plataforma o suelo a %d pixels<span class="es0">\n</span>&quot;</span><span class="sy0">,</span> dist<span class="br0">&#41;</span>;
&nbsp;
y <span class="sy0">+=</span> dist;
&nbsp;
<span class="br0">&#91;</span>...<span class="br0">&#93;</span></pre>
</div>
<!-- SECTION "Colisiones" [2956-5464] -->
<h2><a name="ejemplo" id="ejemplo">Ejemplo</a></h2>
<div class="level2">

<p>

A diferencia de otros artículos, aquí he utilizado el lenguaje de programación C++ y otras técnicas que repasaremos más tarde, como los autómatas y el manejo de la gravedad.
</p>

<p>
<a href="../../../../_detail/referencia/articulos/plataformas/captura.png-id=referencia-articulos-plataformas.html" class="media" title="referencia:articulos:plataformas:captura.png"><img src="../../../../_media/referencia/articulos/plataformas/captura.png" class="mediacenter" title="Captura del programa funcionando" alt="Captura del programa funcionando" /></a>
</p>

<p>
El ejemplo consiste en un personaje que puede ser manejado con los direccionales del teclado. Se puede saltar sobre las plataformas y chocar contra las paredes.


</p>
<ul>
<li class="level1"><div class="li"> <a href="../../../../_media/referencia/articulos/plataformas/colmap.tar.gz" class="media mediafile mf_gz" title="referencia:articulos:plataformas:colmap.tar.gz">Descargar código fuente completo.</a></div>
</li>
<li class="level2"><div class="li"> <a href="../../../../_media/referencia/articulos/plataformas/colmap.zip" class="media mediafile mf_zip" title="referencia:articulos:plataformas:colmap.zip">Versión compilada para Windows.</a></div>
</li>
</ul>

<div class="noteclassic">
Descargando el código fuente completo puede generar la documentación usted mismo: debe tener instalando el programa Doxygen y luego ejecutar make documentacion. La documentación generada se almacena en doc/html. 

</div>

</div>
<!-- SECTION "Ejemplo" [5465-6630] -->
<h2><a name="creditos1" id="creditos1">Créditos</a></h2>
<div class="level2">

<p>

Se permite la copia, modificación y distribución de este artículo sólo bajo los términos de la <strong>GNU Free Documentation License</strong>.
</p>

<p>
El programa de ejemplo se distribuye bajo los términos de la Licencia Pública General de GNU. 

</p>

</div>
<!-- SECTION "Créditos" [6631-] --></div>
</body>
</html>
